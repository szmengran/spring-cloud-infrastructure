package com.szmengran.eureka.controller;

import java.io.BufferedInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.OutputStream;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;

/**
 * @Package com.szmengran.config.controller
 * @Description: 资源管理
 * @date 2018年8月31日 上午9:07:12
 * @author <a href="mailto:android_li@sina.cn">Joe</a>
 */
@RestController
public class ResouceController {

	@GetMapping("/resources/{fileName}")
	public String downloadFile(HttpServletRequest request, HttpServletResponse response, @PathVariable("fileName") String fileName) {
	    if (fileName != null) {
	    	String filePath = this.getClass().getResource("/"+fileName).getPath();
	    	String path = this.getClass().getProtectionDomain().getCodeSource().getLocation().getFile();
	    	System.out.println(path);
	    	System.out.println(filePath);
	        //设置文件路径
	        File file = new File(filePath);
	        if (file.exists()) {
	            response.setContentType("application/force-download");// 设置强制下载不打开
	            response.addHeader("Content-Disposition", "attachment;fileName=" + fileName);// 设置文件名
	            byte[] buffer = new byte[1024];
	            FileInputStream fis = null;
	            BufferedInputStream bis = null;
	            try {
	                fis = new FileInputStream(file);
	                bis = new BufferedInputStream(fis);
	                OutputStream os = response.getOutputStream();
	                int i = bis.read(buffer);
	                while (i != -1) {
	                    os.write(buffer, 0, i);
	                    i = bis.read(buffer);
	                }
	            } catch (Exception e) {
	                e.printStackTrace();
	            } finally {
	                if (bis != null) {
	                    try {
	                        bis.close();
	                    } catch (IOException e) {
	                        e.printStackTrace();
	                    }
	                }
	                if (fis != null) {
	                    try {
	                        fis.close();
	                    } catch (IOException e) {
	                        e.printStackTrace();
	                    }
	                }
	            }
	        }
	    }
	    return null;
	}
}
